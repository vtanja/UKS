{% extends 'repository/repoDetail.html' %}

{% block javascript %}
    <script>
        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
        }

        function drop(ev) {
            console.log("dropped");
            ev.preventDefault();
            let data = ev.dataTransfer.getData("text")
            if(ev.target.id === "TODO" || ev.target.id === "ONGOING" || ev.target.id === "DONE" || ev.target.id === "CLOSED") {
                ev.target.appendChild(document.getElementById(data));
                $.ajax({
                    url: '{% url "update_issue" repository.id %}',
                    data: {
                        'i_id': ev.dataTransfer.getData("text"),
                        'list_id': ev.target.id
                    },
                    dataType: 'json',
                    success: function(result){
                        location.reload();
                        console.log("reloaded")
                    },
                });
            }
        }
    </script>
{% endblock %}

{% block repo-content %}
    <div style="text-align: left; padding: 5mm; margin-left: 1cm; margin-right: 1cm">
        <h3 style="padding: 3mm; text-align: center">
            {{ project.name }}
        </h3>
        <div style="margin-left: 1cm; margin-right: 1cm">
            <h5 style="margin-top: 3mm;">Description</h5>
            <em>{{ project.description }}</em>
        </div>
        <hr style=" border-bottom: darkgray; border-bottom-style: solid; border-bottom-width: thin">
        <div class="row" style="text-align: left;margin-left: 1cm; margin-right: 1cm" >
            {% for key,values in issue_dict.items %}
                <div class="col-sm-4" style="padding: 1mm">
                    <div class="card">
                        <h5 style="margin-top: 2mm; text-align: center;">{{ key }}</h5>
                        <div id="{{ key }}" class="card" style="background-color: #d0e0bd; min-height: 10cm; padding-bottom: 2cm;"
                             ondrop="drop(event)" ondragover="allowDrop(event)">
                            {% for issue in values %}
                                <div id="{{ issue.id }}" class="card" draggable="true" ondragstart="drag(event)"
                                     style="margin-left: 2mm; margin-right: 2mm; margin-top: 2mm; padding: 2mm; background-color: #f2ffed;">
                                    <a style="color: #408f2f" href="{% url 'issue-details' repository.id issue.id %}"><strong>{{ issue.title }}</strong></a>
                                    {% if issue.closed %}
                                        <h5><span class="badge badge-pill badge-secondary">Closed</span></h5>
                                    {% else %}
                                        <h5><span style="font-size: small" class="badge badge-pill badge-success">Open</span></h5>
                                    {% endif %}
                                    <p style="font-size: small"><em>Assignee:</em>
                                        {% for assignee in issue.assignees.all %} {{ assignee.username }}
                                            {% empty %} Not assigned
                                        {% endfor %}
                                    </p>
                                    <div>
                                        {% for label in issue.labels.all %}
                                            <span class="badge badge-light" style="background-color: {{label.color}}!important;color:white">{{label.name}}</span>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>


{% endblock %}